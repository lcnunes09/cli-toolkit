#!/bin/bash
# ghstatus - Show Git repo status at a glance

set -e

VERBOSE=false

[[ "$1" == "--verbose" || "$1" == "-v" ]] && VERBOSE=true

if ! git rev-parse --git-dir > /dev/null 2>&1; then
  echo "ğŸš« Not inside a Git repository."
  exit 1
fi

CURRENT_BRANCH=$(git symbolic-ref --short HEAD)
UNCOMMITTED=$(git status --porcelain)
UNPUSHED_COUNT=$(git log --branches --not --remotes --oneline | wc -l | xargs)
REMOTE=$(git for-each-ref --format='%(upstream:short)' $(git symbolic-ref -q HEAD))
UNMERGED_BRANCHES=$(git branch --no-merged "$CURRENT_BRANCH" | grep -vE "^\*|main|master|dev")

echo "ğŸ§­ Branch: $CURRENT_BRANCH"
echo "ğŸ“Œ Uncommitted changes: $( [ -z "$UNCOMMITTED" ] && echo "no" || echo "yes" )"
echo "â¬†ï¸ Unpushed commits: $UNPUSHED_COUNT"
echo "ğŸ“¦ Unmerged branches (into $CURRENT_BRANCH): $(echo "$UNMERGED_BRANCHES" | wc -l | xargs)"
echo "ğŸ”— Remote tracking: ${REMOTE:-none}"

if [[ "$VERBOSE" == true ]]; then
  echo ""
  echo "ğŸ“„ Unpushed commits:"
  git log --branches --not --remotes --oneline || echo "âœ… None"

  echo ""
  echo "ğŸŒ¿ Unmerged branches:"
  echo "$UNMERGED_BRANCHES" || echo "âœ… None"
fi

echo "âœ… ghstatus completed!"
